<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="rays.web.rays.dao.mybatis.WebScanDao">

	<select id="selectSourceDetectedById" resultType="SourceDetectVo">
		select
		*
		from
		webscan_source_detect where id=#{id}
	</select>
	<select id="selectSourceDetectedList" resultType="SourceDetectVo">
		select
		*
		from
		webscan_source_detect
		<if test="onlyUnAudit">
			where audit_status = 0
		</if>
		order by level_3_count desc,level_2_count desc,level_2_count desc
		limit
		#{offset}, #{len}
	</select>
	<select id="selectSourceDetectedListByHostNames" resultType="SourceDetectVo">
		select
		*
		from webscan_source_detect where  host in
		<foreach collection="hosts" item="hostName" index="index"
			open="(" close=")" separator=",">
			#{hostName}
		</foreach>
		<if test="onlyUnAudit">
		and audit_status = 0 
		</if>
		order by level_3_count desc,level_2_count desc,level_2_count desc
	</select>
	<select id="selectTotalUnAudit" resultType="int">
		select
		count(*)
		from
		webscan_source_detect where audit_status = 0
	</select>

	<update id="setHostStatus" flushCache="true">
		update
		webscan_source_detect set audit_status=#{statusCode} where host =
		#{hostName}
	</update>

</mapper> 